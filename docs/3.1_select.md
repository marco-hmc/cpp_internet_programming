## select

### 1. 相关 api

### 1.1 `select`函数

```c
int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);
```

- **参数说明**：

  - `nfds`：要监视的最大文件描述符加 1。
  - `readfds`：指向一个`fd_set`结构体，用于检查可读性。
  - `writefds`：指向一个`fd_set`结构体，用于检查可写性。
  - `exceptfds`：指向一个`fd_set`结构体，用于检查异常情况。
  - `timeout`：指定`select`函数的超时时间。若为`NULL`，则会一直阻塞，直到有文件描述符就绪；若为`{0, 0}`，则会立即返回。

- **返回值**：
  - 若返回值大于 0，表明有文件描述符就绪。
  - 若返回值等于 0，说明超时。
  - 若返回值小于 0，表明出错。

**select** 函数的作用是检测一组 socket 中某个或某几个是否有“**事件**”，这里的“**事件”**一般分为如下三类：

- 可读事件，一般意味着可以调用 **recv** 或 **read** 函数从该 socket 上读取数据；如果该 socket 是侦听 **socket**（即调用了 **bind** 函数绑定过 ip 地址和端口号，并调用了 **listen** 启动侦听的 socket），可读意味着此时可以有新的客户端连接到来，此时可调用 **accept** 函数接受新连接。
- 可写事件，一般意味着此时调用 **send** 或 **write** 函数可以将数据“发出去”。
- 异常事件，某个 socket 出现异常。

### 1.2 `fd_set`相关函数

`fd_set`是一个文件描述符集合，下面是与之相关的函数：

```c++
void FD_ZERO(fd_set *set);
void FD_SET(int fd, fd_set *set);
void FD_CLR(int fd, fd_set *set);
int  FD_ISSET(int fd, fd_set *set);
```

- `FD_ZERO`：把`fd_set`集合清空。
- `FD_SET`：将指定的文件描述符添加到`fd_set`集合中。
- `FD_CLR`：从`fd_set`集合里移除指定的文件描述符。
- `FD_ISSET`：检查指定的文件描述符是否在`fd_set`集合中。

### 1.3 `struct timeval`结构体

```c
#include <sys/time.h>

struct timeval {
    long    tv_sec;         /* seconds */
    long    tv_usec;        /* microseconds */
};
```

该结构体用来指定`select`函数的超时时间，`tv_sec`代表秒数，`tv_usec`代表微秒数。
