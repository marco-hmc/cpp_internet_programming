---
layout: post
title: ï¼ˆå…­ï¼‰è®¡ç½‘é‚£äº›äº‹å„¿ï¼šåº”ç”¨å±‚-DNS
categories: è®¡ç®—æœºç½‘ç»œ
related_posts: True
tags: network
toc:
  sidebar: right
---

## DNSåè®®è¯¦è§£ - äº’è”ç½‘çš„ç”µè¯ç°¿

- ç†è§£DNSåè®®è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜
- æŒæ¡DNSåŸŸåè§£æçš„åŸºæœ¬æµç¨‹å’ŒåŸç†
- äº†è§£DNSåœ¨å®é™…ç½‘ç»œåº”ç”¨ä¸­çš„é‡è¦ä½œç”¨
- è®¤è¯†DNSè´Ÿè½½å‡è¡¡å’Œæ€§èƒ½ä¼˜åŒ–æœºåˆ¶
- ç†è§£ç°ä»£DNSæŠ€æœ¯å‘å±•å’Œåº”ç”¨åœºæ™¯

---

### 1. ä¸ºä»€ä¹ˆéœ€è¦DNSï¼Ÿè¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

#### ğŸ¤” **ç°å®é—®é¢˜å¼•å…¥**

æƒ³è±¡1980å¹´ä»£çš„äº’è”ç½‘ä¸–ç•Œï¼š
- **è®°å¿†å›°éš¾**: è¦è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œå¿…é¡»è®°ä½ç±»ä¼¼192.168.1.1è¿™æ ·çš„IPåœ°å€
- **ä¸æ˜“è®°å¿†**: æ™®é€šç”¨æˆ·å¾ˆéš¾è®°ä½å¤§é‡çš„æ•°å­—ç»„åˆ
- **å˜æ›´å›°éš¾**: æœåŠ¡å™¨IPåœ°å€å˜æ›´æ—¶ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½éœ€è¦æ›´æ–°
- **æ‰©å±•æ€§å·®**: éšç€ç½‘ç»œè§„æ¨¡å¢é•¿ï¼ŒIPåœ°å€ç®¡ç†å˜å¾—ä¸å¯è¡Œ

**DNSçš„ä½¿å‘½**: è®©äº’è”ç½‘å˜å¾—ç”¨æˆ·å‹å¥½ï¼Œå°†éš¾è®°çš„IPåœ°å€è½¬æ¢ä¸ºæ˜“è®°çš„åŸŸå

#### ğŸ“‹ **DNSè¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

| é—®é¢˜ | æ²¡æœ‰DNSçš„å›°éš¾ | DNSçš„è§£å†³æ–¹æ¡ˆ | å®é™…ä½“ç° |
|------|--------------|--------------|----------|
| **è®°å¿†è´Ÿæ‹…** | éœ€è¦è®°ä½å¤§é‡IPåœ°å€ | æ˜“è®°çš„åŸŸåç³»ç»Ÿ | google.com vs 172.217.12.14 |
| **åœ°å€å˜æ›´** | IPå˜æ›´å½±å“æ‰€æœ‰ç”¨æˆ· | åŸŸåä¸å˜ï¼ŒIPå¯å˜ | æœåŠ¡å™¨è¿ç§»å¯¹ç”¨æˆ·é€æ˜ |
| **æ‰©å±•ç®¡ç†** | é›†ä¸­ç®¡ç†æ‰€æœ‰åœ°å€ | åˆ†å±‚åˆ†å¸ƒå¼ç®¡ç† | å…¨çƒåŸŸåç»Ÿä¸€ç®¡ç† |
| **æœåŠ¡å‘ç°** | æ— æ³•æ ‡è¯†ä¸åŒæœåŠ¡ | å­åŸŸååŒºåˆ†æœåŠ¡ | mail.google.com, maps.google.com |

#### ğŸŒ **DNSçš„è®¾è®¡å“²å­¦**

```
DNS = Domain Name System (åŸŸåç³»ç»Ÿ)

è®¾è®¡åŸåˆ™ï¼š
âœ… åˆ†å±‚ç»“æ„ - æ ‘çŠ¶ç»„ç»‡ä¾¿äºç®¡ç†
âœ… åˆ†å¸ƒå¼ - åˆ†æ•£è´Ÿè½½é¿å…å•ç‚¹æ•…éšœ
âœ… ç¼“å­˜æœºåˆ¶ - æé«˜æŸ¥è¯¢æ•ˆç‡
âœ… è´Ÿè½½å‡è¡¡ - æ”¯æŒé«˜å¯ç”¨æ€§æœåŠ¡
```

---

### 2. DNSå·¥ä½œåŸç† - ä»åŸŸååˆ°IPçš„è½¬æ¢

#### ğŸ—ï¸ **DNSå±‚æ¬¡ç»“æ„**

```
DNSæ ‘çŠ¶ç»“æ„ï¼š

                    . (æ ¹)
                   /  |  \
                .com .org .cn  ... (é¡¶çº§åŸŸ)
               /  |   |
          google baidu amazon  ... (äºŒçº§åŸŸ)
          /  |  \
        www mail maps  ... (å­åŸŸ)

å®é™…ä¾‹å­ï¼š
www.google.com
â”œâ”€ .com (é¡¶çº§åŸŸ)
â”œâ”€ google (äºŒçº§åŸŸ)  
â””â”€ www (å­åŸŸ)
```

#### ğŸ“ **DNSæœåŠ¡å™¨ç±»å‹å’ŒèŒè´£**

##### **å››ç§å…³é”®DNSæœåŠ¡å™¨**

```
1. æ ¹DNSæœåŠ¡å™¨ (Root)
   - å…¨çƒ13ä¸ªé€»è¾‘æ ¹æœåŠ¡å™¨
   - å‘Šè¯‰ä½ .com/.orgç­‰åœ¨å“ªé‡Œ
   - ç”±ICANNç®¡ç†

2. é¡¶çº§åŸŸDNSæœåŠ¡å™¨ (TLD)
   - .com, .org, .cnç­‰
   - å‘Šè¯‰ä½ google.comåœ¨å“ªé‡Œ
   - åˆ†ä¸ºgTLDå’ŒccTLD

3. æƒå¨DNSæœåŠ¡å™¨ (Authoritative)
   - å­˜å‚¨åŸŸåçš„çœŸå®IPåœ°å€
   - "æˆ‘çš„åŸŸåæˆ‘åšä¸»"
   - ä¼ä¸šè‡ªå·±ç®¡ç†

4. é€’å½’DNSè§£æå™¨ (Recursive)
   - ä»£æ›¿ç”¨æˆ·å»æŸ¥è¯¢
   - é€šå¸¸ç”±ISPæä¾›
   - 8.8.8.8, 1.1.1.1ç­‰å…¬å…±DNS
```

#### ğŸ”„ **DNSè§£ææµç¨‹è¯¦è§£**

##### **å®Œæ•´è§£æè¿‡ç¨‹**
```
ç”¨æˆ·è¾“å…¥: https://www.google.com

æ­¥éª¤1: æ£€æŸ¥æœ¬åœ°ç¼“å­˜
æµè§ˆå™¨ â†’ æ“ä½œç³»ç»Ÿ â†’ hostsæ–‡ä»¶
å¦‚æœæ‰¾åˆ° â†’ ç›´æ¥ä½¿ç”¨
å¦‚æœæ²¡æ‰¾åˆ° â†’ ç»§ç»­æ­¥éª¤2

æ­¥éª¤2: æŸ¥è¯¢é€’å½’DNSæœåŠ¡å™¨ (å¦‚8.8.8.8)
å¦‚æœç¼“å­˜ä¸­æœ‰ â†’ ç›´æ¥è¿”å›
å¦‚æœæ²¡æœ‰ â†’ å¼€å§‹é€’å½’æŸ¥è¯¢

æ­¥éª¤3: é€’å½’æŸ¥è¯¢è¿‡ç¨‹
é€’å½’DNS â†’ æ ¹æœåŠ¡å™¨: "www.google.comåœ¨å“ªï¼Ÿ"
æ ¹æœåŠ¡å™¨ â†’ é€’å½’DNS: "å»é—®.comæœåŠ¡å™¨ï¼Œåœ°å€æ˜¯x.x.x.x"

é€’å½’DNS â†’ .comæœåŠ¡å™¨: "www.google.comåœ¨å“ªï¼Ÿ"
.comæœåŠ¡å™¨ â†’ é€’å½’DNS: "å»é—®google.comæœåŠ¡å™¨ï¼Œåœ°å€æ˜¯y.y.y.y"

é€’å½’DNS â†’ google.comæœåŠ¡å™¨: "www.google.comåœ¨å“ªï¼Ÿ"
google.com â†’ é€’å½’DNS: "www.google.comçš„IPæ˜¯172.217.12.14"

æ­¥éª¤4: è¿”å›ç»“æœ
é€’å½’DNS â†’ ç”¨æˆ·: "www.google.com = 172.217.12.14"
ç”¨æˆ·æµè§ˆå™¨ä½¿ç”¨IPåœ°å€å»ºç«‹è¿æ¥
```

##### **DNSæŸ¥è¯¢å®è·µç¤ºä¾‹**
```python
import socket
import dns.resolver
import time

class DNSExplorer:
    def __init__(self):
        self.query_history = []
    
    def simple_lookup(self, domain):
        """åŸºæœ¬åŸŸåè§£æ"""
        start_time = time.time()
        try:
            ip = socket.gethostbyname(domain)
            end_time = time.time()
            
            result = {
                'domain': domain,
                'ip': ip,
                'query_time': round((end_time - start_time) * 1000, 2)
            }
            
            self.query_history.append(result)
            print(f"åŸŸå: {domain}")
            print(f"IPåœ°å€: {ip}")
            print(f"æŸ¥è¯¢è€—æ—¶: {result['query_time']}ms")
            
            return result
            
        except socket.gaierror as e:
            print(f"è§£æå¤±è´¥: {domain} - {e}")
            return None
    
    def detailed_lookup(self, domain):
        """è¯¦ç»†DNSè®°å½•æŸ¥è¯¢"""
        record_types = ['A', 'AAAA', 'CNAME', 'MX', 'NS', 'TXT']
        results = {}
        
        for record_type in record_types:
            try:
                answers = dns.resolver.resolve(domain, record_type)
                results[record_type] = []
                
                for answer in answers:
                    results[record_type].append(str(answer))
                    
                print(f"{record_type}è®°å½•:")
                for answer in results[record_type]:
                    print(f"  {answer}")
                    
            except Exception as e:
                results[record_type] = f"æŸ¥è¯¢å¤±è´¥: {e}"
        
        return results
    
    def trace_dns_path(self, domain):
        """æ¨¡æ‹ŸDNSæŸ¥è¯¢è·¯å¾„"""
        print(f"\n=== è¿½è¸ª {domain} çš„DNSè§£æè·¯å¾„ ===")
        
        # 1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜
        print("1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜...")
        local_result = self.simple_lookup(domain)
        
        # 2. æ˜¾ç¤ºDNSæœåŠ¡å™¨ä¿¡æ¯
        print("\n2. ä½¿ç”¨çš„DNSæœåŠ¡å™¨:")
        import subprocess
        try:
            result = subprocess.run(['nslookup', domain], 
                                  capture_output=True, text=True)
            lines = result.stdout.split('\n')
            for line in lines[:3]:  # æ˜¾ç¤ºå‰å‡ è¡ŒåŒ…å«DNSæœåŠ¡å™¨ä¿¡æ¯
                if line.strip():
                    print(f"   {line}")
        except:
            print("   æ— æ³•è·å–DNSæœåŠ¡å™¨ä¿¡æ¯")
        
        # 3. æ˜¾ç¤ºè§£æç»“æœ
        print(f"\n3. æœ€ç»ˆè§£æç»“æœ:")
        if local_result:
            print(f"   {domain} â†’ {local_result['ip']}")
            print(f"   æŸ¥è¯¢è€—æ—¶: {local_result['query_time']}ms")
        
        return local_result

# ä½¿ç”¨ç¤ºä¾‹
dns_explorer = DNSExplorer()

# åŸºæœ¬æŸ¥è¯¢
print("=== åŸºæœ¬DNSæŸ¥è¯¢ ===")
dns_explorer.simple_lookup('google.com')
dns_explorer.simple_lookup('baidu.com')
dns_explorer.simple_lookup('github.com')

# è¯¦ç»†è®°å½•æŸ¥è¯¢
print("\n=== è¯¦ç»†DNSè®°å½•æŸ¥è¯¢ ===")
dns_explorer.detailed_lookup('google.com')

# è¿½è¸ªDNSè·¯å¾„
print("\n=== DNSè§£æè·¯å¾„è¿½è¸ª ===")
dns_explorer.trace_dns_path('www.example.com')
```

---

### 3. DNSè®°å½•ç±»å‹ - ä¸åŒåŠŸèƒ½çš„æ•°æ®å­˜å‚¨

#### ğŸ“ **ä¸»è¦DNSè®°å½•ç±»å‹**

##### **æ ¸å¿ƒè®°å½•ç±»å‹è§£æ**
```python
class DNSRecords:
    def __init__(self):
        self.record_types = {
            'A': {
                'description': 'IPv4åœ°å€è®°å½•',
                'example': 'google.com. 300 IN A 172.217.12.14',
                'use_case': 'å°†åŸŸåæŒ‡å‘IPv4åœ°å€'
            },
            'AAAA': {
                'description': 'IPv6åœ°å€è®°å½•', 
                'example': 'google.com. 300 IN AAAA 2404:6800:4003:c02::71',
                'use_case': 'å°†åŸŸåæŒ‡å‘IPv6åœ°å€'
            },
            'CNAME': {
                'description': 'åˆ«åè®°å½•',
                'example': 'www.example.com. 300 IN CNAME example.com.',
                'use_case': 'ä¸ºåŸŸååˆ›å»ºåˆ«åï¼Œä¾¿äºç®¡ç†'
            },
            'MX': {
                'description': 'é‚®ä»¶äº¤æ¢è®°å½•',
                'example': 'example.com. 300 IN MX 10 mail.example.com.',
                'use_case': 'æŒ‡å®šé‚®ä»¶æœåŠ¡å™¨åœ°å€'
            },
            'NS': {
                'description': 'åç§°æœåŠ¡å™¨è®°å½•',
                'example': 'example.com. 300 IN NS ns1.example.com.',
                'use_case': 'æŒ‡å®šåŸŸåçš„æƒå¨DNSæœåŠ¡å™¨'
            },
            'TXT': {
                'description': 'æ–‡æœ¬è®°å½•',
                'example': 'example.com. 300 IN TXT "v=spf1 include:_spf.google.com ~all"',
                'use_case': 'å­˜å‚¨éªŒè¯ä¿¡æ¯ã€é…ç½®ä¿¡æ¯ç­‰'
            }
        }
    
    def explain_record(self, record_type):
        """è§£é‡ŠDNSè®°å½•ç±»å‹"""
        if record_type in self.record_types:
            info = self.record_types[record_type]
            print(f"è®°å½•ç±»å‹: {record_type}")
            print(f"è¯´æ˜: {info['description']}")
            print(f"ç¤ºä¾‹: {info['example']}")
            print(f"ç”¨é€”: {info['use_case']}")
        else:
            print(f"æœªçŸ¥çš„è®°å½•ç±»å‹: {record_type}")

# å®é™…åº”ç”¨ç¤ºä¾‹
dns_records = DNSRecords()

# è§£é‡Šä¸åŒè®°å½•ç±»å‹
for record_type in ['A', 'CNAME', 'MX']:
    dns_records.explain_record(record_type)
    print("-" * 50)
```

##### **DNSè®°å½•çš„å®é™…åº”ç”¨åœºæ™¯**

```
1. ç½‘ç«™æ‰˜ç®¡ (Aè®°å½•)
   website.com â†’ 192.168.1.100
   ç”¨é€”: åŸºæœ¬çš„ç½‘ç«™è®¿é—®

2. CDNåŠ é€Ÿ (CNAMEè®°å½•)
   cdn.website.com â†’ cdn-provider.com
   ç”¨é€”: å†…å®¹åˆ†å‘ç½‘ç»œï¼Œæé«˜è®¿é—®é€Ÿåº¦

3. é‚®ä»¶æœåŠ¡ (MXè®°å½•)
   website.com â†’ mail.website.com (ä¼˜å…ˆçº§10)
   ç”¨é€”: é‚®ä»¶æŠ•é€’åˆ°æ­£ç¡®çš„é‚®ä»¶æœåŠ¡å™¨

4. æœåŠ¡éªŒè¯ (TXTè®°å½•)
   website.com â†’ "google-site-verification=abc123"
   ç”¨é€”: ç½‘ç«™æ‰€æœ‰æƒéªŒè¯ã€SPFååƒåœ¾é‚®ä»¶ç­‰

5. è´Ÿè½½å‡è¡¡ (å¤šä¸ªAè®°å½•)
   api.website.com â†’ 192.168.1.100
   api.website.com â†’ 192.168.1.101
   api.website.com â†’ 192.168.1.102
   ç”¨é€”: åˆ†æ•£è®¿é—®è´Ÿè½½ï¼Œæé«˜å¯ç”¨æ€§
```

---

### 4. DNSç¼“å­˜æœºåˆ¶ - æé«˜æŸ¥è¯¢æ•ˆç‡

#### âš¡ **å¤šçº§ç¼“å­˜ä½“ç³»**

**è¦è§£å†³çš„é—®é¢˜**: DNSæŸ¥è¯¢æ¶‰åŠå¤šä¸ªæœåŠ¡å™¨ï¼Œå¦‚ä½•å‡å°‘æŸ¥è¯¢å»¶è¿Ÿï¼Ÿ

##### **DNSç¼“å­˜å±‚æ¬¡**
```
DNSç¼“å­˜å±‚æ¬¡ç»“æ„ï¼š

1. æµè§ˆå™¨ç¼“å­˜ (æœ€å¿«)
   â”œâ”€ ç¼“å­˜æ—¶é—´: é€šå¸¸å‡ åˆ†é’Ÿåˆ°1å°æ—¶
   â”œâ”€ å­˜å‚¨ä½ç½®: æµè§ˆå™¨å†…å­˜
   â””â”€ ä¼˜ç‚¹: å“åº”æœ€å¿«ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚

2. æ“ä½œç³»ç»Ÿç¼“å­˜ (ç³»ç»Ÿçº§)
   â”œâ”€ ç¼“å­˜æ—¶é—´: æ ¹æ®TTLè®¾ç½®
   â”œâ”€ å­˜å‚¨ä½ç½®: ç³»ç»ŸDNSç¼“å­˜
   â””â”€ ä¼˜ç‚¹: æ‰€æœ‰åº”ç”¨å…±äº«

3. è·¯ç”±å™¨ç¼“å­˜ (ç½‘ç»œçº§)
   â”œâ”€ ç¼“å­˜æ—¶é—´: è¾ƒé•¿æ—¶é—´
   â”œâ”€ å­˜å‚¨ä½ç½®: è·¯ç”±å™¨å†…å­˜
   â””â”€ ä¼˜ç‚¹: å±€åŸŸç½‘å†…å…±äº«

4. ISPé€’å½’DNSç¼“å­˜ (è¿è¥å•†çº§)
   â”œâ”€ ç¼“å­˜æ—¶é—´: æ ¹æ®TTL
   â”œâ”€ å­˜å‚¨ä½ç½®: è¿è¥å•†DNSæœåŠ¡å™¨
   â””â”€ ä¼˜ç‚¹: åœ°åŸŸç”¨æˆ·å…±äº«

5. æƒå¨DNSæœåŠ¡å™¨ (æºå¤´)
   â”œâ”€ ç¼“å­˜æ—¶é—´: æ— ç¼“å­˜
   â”œâ”€ å­˜å‚¨ä½ç½®: æƒå¨æœåŠ¡å™¨
   â””â”€ ä¼˜ç‚¹: æ•°æ®æœ€æ–°æœ€å‡†ç¡®
```

##### **TTL (Time To Live) æœºåˆ¶**
```python
class DNSCache:
    def __init__(self):
        self.cache = {}
        
    def set_record(self, domain, ip, ttl):
        """è®¾ç½®DNSè®°å½•å’ŒTTL"""
        import time
        self.cache[domain] = {
            'ip': ip,
            'ttl': ttl,
            'timestamp': time.time()
        }
        print(f"ç¼“å­˜è®¾ç½®: {domain} â†’ {ip} (TTL: {ttl}ç§’)")
    
    def get_record(self, domain):
        """è·å–DNSè®°å½•ï¼Œæ£€æŸ¥TTL"""
        import time
        
        if domain not in self.cache:
            print(f"ç¼“å­˜æœªå‘½ä¸­: {domain}")
            return None
        
        record = self.cache[domain]
        elapsed = time.time() - record['timestamp']
        
        if elapsed > record['ttl']:
            print(f"ç¼“å­˜è¿‡æœŸ: {domain} (å·²è¿‡æœŸ {elapsed:.1f}ç§’)")
            del self.cache[domain]
            return None
        
        remaining_ttl = record['ttl'] - elapsed
        print(f"ç¼“å­˜å‘½ä¸­: {domain} â†’ {record['ip']} (å‰©ä½™TTL: {remaining_ttl:.1f}ç§’)")
        return record['ip']
    
    def show_cache_status(self):
        """æ˜¾ç¤ºç¼“å­˜çŠ¶æ€"""
        import time
        current_time = time.time()
        
        print("=== DNSç¼“å­˜çŠ¶æ€ ===")
        for domain, record in self.cache.items():
            elapsed = current_time - record['timestamp']
            remaining = record['ttl'] - elapsed
            
            if remaining > 0:
                print(f"{domain}: {record['ip']} (å‰©ä½™: {remaining:.1f}s)")
            else:
                print(f"{domain}: å·²è¿‡æœŸ")

# ç¼“å­˜æœºåˆ¶æ¼”ç¤º
dns_cache = DNSCache()

# è®¾ç½®ä¸åŒTTLçš„è®°å½•
dns_cache.set_record('fast.example.com', '1.1.1.1', 60)    # 1åˆ†é’ŸTTL
dns_cache.set_record('slow.example.com', '2.2.2.2', 3600)  # 1å°æ—¶TTL

# æŸ¥è¯¢è®°å½•
dns_cache.get_record('fast.example.com')
dns_cache.get_record('slow.example.com')

# æ˜¾ç¤ºç¼“å­˜çŠ¶æ€
dns_cache.show_cache_status()
```

---

### 5. DNSè´Ÿè½½å‡è¡¡ - æ™ºèƒ½æµé‡åˆ†å‘

#### âš–ï¸ **DNSè´Ÿè½½å‡è¡¡åŸç†**

**è¦è§£å†³çš„é—®é¢˜**: å¦‚ä½•å°†ç”¨æˆ·è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼Ÿ

##### **DNSè´Ÿè½½å‡è¡¡ç±»å‹**

```python
class DNSLoadBalancer:
    def __init__(self):
        self.servers = []
        self.weights = {}
        self.current_index = 0
    
    def add_server(self, ip, weight=1):
        """æ·»åŠ æœåŠ¡å™¨"""
        self.servers.append(ip)
        self.weights[ip] = weight
        print(f"æ·»åŠ æœåŠ¡å™¨: {ip} (æƒé‡: {weight})")
    
    def round_robin(self):
        """è½®è¯¢è´Ÿè½½å‡è¡¡"""
        if not self.servers:
            return None
        
        server = self.servers[self.current_index]
        self.current_index = (self.current_index + 1) % len(self.servers)
        
        print(f"è½®è¯¢é€‰æ‹©: {server}")
        return server
    
    def weighted_round_robin(self):
        """åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡"""
        if not self.servers:
            return None
        
        # ç®€åŒ–çš„åŠ æƒç®—æ³•
        total_weight = sum(self.weights.values())
        import random
        weight_sum = random.randint(1, total_weight)
        
        current_weight = 0
        for server in self.servers:
            current_weight += self.weights[server]
            if weight_sum <= current_weight:
                print(f"åŠ æƒé€‰æ‹©: {server} (æƒé‡: {self.weights[server]})")
                return server
        
        return self.servers[0]
    
    def geographic_selection(self, user_location):
        """åœ°ç†ä½ç½®è´Ÿè½½å‡è¡¡"""
        geographic_mapping = {
            'beijing': '192.168.1.100',    # åŒ—äº¬æœåŠ¡å™¨
            'shanghai': '192.168.1.101',   # ä¸Šæµ·æœåŠ¡å™¨
            'guangzhou': '192.168.1.102',  # å¹¿å·æœåŠ¡å™¨
            'default': '192.168.1.100'     # é»˜è®¤æœåŠ¡å™¨
        }
        
        server = geographic_mapping.get(user_location.lower(), 
                                      geographic_mapping['default'])
        print(f"åœ°ç†é€‰æ‹©: {user_location} â†’ {server}")
        return server

# è´Ÿè½½å‡è¡¡æ¼”ç¤º
lb = DNSLoadBalancer()

# æ·»åŠ æœåŠ¡å™¨
lb.add_server('192.168.1.100', weight=3)  # é«˜é…ç½®æœåŠ¡å™¨
lb.add_server('192.168.1.101', weight=2)  # ä¸­é…ç½®æœåŠ¡å™¨
lb.add_server('192.168.1.102', weight=1)  # ä½é…ç½®æœåŠ¡å™¨

print("\n=== è½®è¯¢è´Ÿè½½å‡è¡¡ ===")
for i in range(6):
    lb.round_robin()

print("\n=== åŠ æƒè´Ÿè½½å‡è¡¡ ===")
for i in range(6):
    lb.weighted_round_robin()

print("\n=== åœ°ç†ä½ç½®è´Ÿè½½å‡è¡¡ ===")
locations = ['beijing', 'shanghai', 'guangzhou', 'unknown']
for location in locations:
    lb.geographic_selection(location)
```

##### **å®é™…è´Ÿè½½å‡è¡¡åº”ç”¨æ¡ˆä¾‹**

```
1. CDNå†…å®¹åˆ†å‘
   é—®é¢˜: å…¨çƒç”¨æˆ·è®¿é—®åŒä¸€ä¸ªç½‘ç«™ï¼Œå»¶è¿Ÿå¾ˆé«˜
   æ–¹æ¡ˆ: DNSè¿”å›æœ€è¿‘CDNèŠ‚ç‚¹çš„IPåœ°å€
   
   ç”¨æˆ·ä½ç½®     DNSè¿”å›çš„IP        CDNèŠ‚ç‚¹
   åŒ—äº¬ç”¨æˆ·  â†’  1.1.1.1       â†’  åŒ—äº¬CDNèŠ‚ç‚¹
   ä¸Šæµ·ç”¨æˆ·  â†’  2.2.2.2       â†’  ä¸Šæµ·CDNèŠ‚ç‚¹
   å¹¿å·ç”¨æˆ·  â†’  3.3.3.3       â†’  å¹¿å·CDNèŠ‚ç‚¹

2. å¤šæœºæˆ¿å®¹ç¾
   é—®é¢˜: å•æœºæˆ¿æ•…éšœå½±å“æ‰€æœ‰ç”¨æˆ·
   æ–¹æ¡ˆ: DNSå¥åº·æ£€æŸ¥ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¯ç”¨æœºæˆ¿
   
   æ­£å¸¸æƒ…å†µ:
   api.service.com â†’ ä¸»æœºæˆ¿IP (1.1.1.1)
   
   ä¸»æœºæˆ¿æ•…éšœ:
   api.service.com â†’ å¤‡ç”¨æœºæˆ¿IP (2.2.2.2)

3. æœåŠ¡å™¨è´Ÿè½½åˆ†æ‹…
   é—®é¢˜: å•å°æœåŠ¡å™¨å‹åŠ›è¿‡å¤§
   æ–¹æ¡ˆ: DNSè¿”å›å¤šä¸ªæœåŠ¡å™¨IPï¼Œåˆ†æ‹…è´Ÿè½½
   
   api.service.com â†’ [1.1.1.1, 2.2.2.2, 3.3.3.3]
   å®¢æˆ·ç«¯éšæœºé€‰æ‹©å…¶ä¸­ä¸€ä¸ªIPè®¿é—®
```

---

### 6. DNSå®‰å…¨ä¸ä¼˜åŒ–

#### ğŸ”’ **DNSå®‰å…¨æŒ‘æˆ˜**

**è¦è§£å†³çš„é—®é¢˜**: DNSå¦‚ä½•é˜²èŒƒå„ç§ç½‘ç»œæ”»å‡»ï¼Ÿ

##### **å¸¸è§DNSå®‰å…¨å¨èƒ**

```python
class DNSSecurity:
    def __init__(self):
        self.threat_examples = {
            'dns_hijacking': {
                'description': 'DNSåŠ«æŒæ”»å‡»',
                'attack_method': 'ä¿®æ”¹DNSè§£æç»“æœ',
                'example': 'bank.comè¢«è§£æåˆ°æ¶æ„ç½‘ç«™IP',
                'impact': 'ç”¨æˆ·è®¿é—®è™šå‡ç½‘ç«™ï¼Œæ³„éœ²æ•æ„Ÿä¿¡æ¯',
                'prevention': 'ä½¿ç”¨HTTPSã€DNS over HTTPS'
            },
            'cache_poisoning': {
                'description': 'DNSç¼“å­˜æŠ•æ¯’',
                'attack_method': 'æ±¡æŸ“DNSæœåŠ¡å™¨ç¼“å­˜',
                'example': 'å‘é€’å½’DNSå‘é€è™šå‡å“åº”',
                'impact': 'å¤§é‡ç”¨æˆ·å—åˆ°å½±å“',
                'prevention': 'éšæœºåŒ–æŸ¥è¯¢IDã€ä½¿ç”¨DNSSEC'
            },
            'ddos_attack': {
                'description': 'DNS DDoSæ”»å‡»',
                'attack_method': 'å¤§é‡è¯·æ±‚å‹å®DNSæœåŠ¡å™¨',
                'example': 'åƒµå°¸ç½‘ç»œåŒæ—¶æŸ¥è¯¢åŒä¸€åŸŸå',
                'impact': 'DNSæœåŠ¡ä¸å¯ç”¨ï¼Œç½‘ç«™æ— æ³•è®¿é—®',
                'prevention': 'æµé‡åˆ†æ•£ã€é™é€Ÿã€äº‘é˜²æŠ¤'
            }
        }
    
    def explain_threat(self, threat_type):
        """è§£é‡ŠDNSå®‰å…¨å¨èƒ"""
        if threat_type in self.threat_examples:
            threat = self.threat_examples[threat_type]
            print(f"å¨èƒç±»å‹: {threat['description']}")
            print(f"æ”»å‡»æ–¹å¼: {threat['attack_method']}")
            print(f"æ”»å‡»ç¤ºä¾‹: {threat['example']}")
            print(f"å½±å“: {threat['impact']}")
            print(f"é˜²æŠ¤æªæ–½: {threat['prevention']}")
        else:
            print(f"æœªçŸ¥å¨èƒç±»å‹: {threat_type}")
    
    def check_dns_security(self, domain):
        """æ£€æŸ¥DNSå®‰å…¨é…ç½®"""
        import dns.resolver
        
        security_checks = {
            'dnssec': False,
            'caa_record': False,
            'multiple_ns': False
        }
        
        try:
            # æ£€æŸ¥DNSSEC
            answers = dns.resolver.resolve(domain, 'DNSKEY')
            if answers:
                security_checks['dnssec'] = True
                print(f"âœ… {domain} å¯ç”¨äº†DNSSEC")
        except:
            print(f"âŒ {domain} æœªå¯ç”¨DNSSEC")
        
        try:
            # æ£€æŸ¥CAAè®°å½•
            answers = dns.resolver.resolve(domain, 'CAA')
            if answers:
                security_checks['caa_record'] = True
                print(f"âœ… {domain} é…ç½®äº†CAAè®°å½•")
        except:
            print(f"âŒ {domain} æœªé…ç½®CAAè®°å½•")
        
        try:
            # æ£€æŸ¥NSè®°å½•æ•°é‡
            answers = dns.resolver.resolve(domain, 'NS')
            if len(answers) >= 2:
                security_checks['multiple_ns'] = True
                print(f"âœ… {domain} é…ç½®äº†å¤šä¸ªåç§°æœåŠ¡å™¨")
            else:
                print(f"âš ï¸ {domain} åªæœ‰{len(answers)}ä¸ªåç§°æœåŠ¡å™¨")
        except:
            print(f"âŒ {domain} NSè®°å½•æŸ¥è¯¢å¤±è´¥")
        
        return security_checks

# DNSå®‰å…¨æ¼”ç¤º
dns_security = DNSSecurity()

# è§£é‡Šå®‰å…¨å¨èƒ
for threat in ['dns_hijacking', 'cache_poisoning', 'ddos_attack']:
    dns_security.explain_threat(threat)
    print("-" * 50)

# æ£€æŸ¥åŸŸåå®‰å…¨é…ç½®
print("\n=== DNSå®‰å…¨æ£€æŸ¥ ===")
dns_security.check_dns_security('google.com')
```

#### ğŸš€ **ç°ä»£DNSä¼˜åŒ–æŠ€æœ¯**

##### **DoH (DNS over HTTPS) å’Œ DoT (DNS over TLS)**

```python
import requests
import json

class ModernDNS:
    def __init__(self):
        # å…¬å…±DoHæœåŠ¡å™¨
        self.doh_servers = {
            'cloudflare': 'https://1.1.1.1/dns-query',
            'google': 'https://8.8.8.8/dns-query',
            'quad9': 'https://9.9.9.9/dns-query'
        }
    
    def doh_query(self, domain, record_type='A', provider='cloudflare'):
        """DNS over HTTPSæŸ¥è¯¢"""
        if provider not in self.doh_servers:
            print(f"ä¸æ”¯æŒçš„DoHæä¾›å•†: {provider}")
            return None
        
        url = self.doh_servers[provider]
        headers = {
            'Accept': 'application/dns-json'
        }
        params = {
            'name': domain,
            'type': record_type
        }
        
        try:
            response = requests.get(url, headers=headers, params=params, timeout=5)
            if response.status_code == 200):
                data = response.json()
                
                print(f"DoHæŸ¥è¯¢ç»“æœ ({provider}):")
                print(f"åŸŸå: {domain}")
                print(f"è®°å½•ç±»å‹: {record_type}")
                
                if 'Answer' in data:
                    for answer in data['Answer']:
                        print(f"ç»“æœ: {answer['data']} (TTL: {answer['TTL']})")
                else:
                    print("æœªæ‰¾åˆ°è®°å½•")
                
                return data
            else:
                print(f"DoHæŸ¥è¯¢å¤±è´¥: HTTP {response.status_code}")
                return None
                
        except Exception as e:
            print(f"DoHæŸ¥è¯¢é”™è¯¯: {e}")
            return None
    
    def compare_dns_methods(self, domain):
        """æ¯”è¾ƒä¸åŒDNSæŸ¥è¯¢æ–¹æ³•"""
        import time
        import socket
        
        methods = {}
        
        # ä¼ ç»ŸDNSæŸ¥è¯¢
        start_time = time.time()
        try:
            ip = socket.gethostbyname(domain)
            methods['traditional'] = {
                'result': ip,
                'time': (time.time() - start_time) * 1000,
                'encrypted': False
            }
        except:
            methods['traditional'] = {
                'result': 'Failed',
                'time': -1,
                'encrypted': False
            }
        
        # DoHæŸ¥è¯¢
        start_time = time.time()
        try:
            doh_result = self.doh_query(domain, provider='cloudflare')
            if doh_result and 'Answer' in doh_result:
                ip = doh_result['Answer'][0]['data']
                methods['doh'] = {
                    'result': ip,
                    'time': (time.time() - start_time) * 1000,
                    'encrypted': True
                }
            else:
                methods['doh'] = {
                    'result': 'Failed',
                    'time': -1,
                    'encrypted': True
                }
        except:
            methods['doh'] = {
                'result': 'Failed',
                'time': -1,
                'encrypted': True
            }
        
        # æ˜¾ç¤ºæ¯”è¾ƒç»“æœ
        print(f"\n=== DNSæŸ¥è¯¢æ–¹æ³•æ¯”è¾ƒ: {domain} ===")
        for method, result in methods.items():
            encrypted_status = "ğŸ”’åŠ å¯†" if result['encrypted'] else "ğŸ”“æ˜æ–‡"
            print(f"{method.upper()}: {result['result']} "
                  f"({result['time']:.1f}ms) {encrypted_status}")
        
        return methods

# ç°ä»£DNSæŠ€æœ¯æ¼”ç¤º
modern_dns = ModernDNS()

# DoHæŸ¥è¯¢ç¤ºä¾‹
print("=== DNS over HTTPS æŸ¥è¯¢ ===")
modern_dns.doh_query('google.com', 'A', 'cloudflare')

# æ¯”è¾ƒä¸åŒDNSæ–¹æ³•
print("\n=== DNSæ–¹æ³•æ¯”è¾ƒ ===")
modern_dns.compare_dns_methods('github.com')
```

---

### 7. HTTPDNS - ç§»åŠ¨äº’è”ç½‘çš„DNSä¼˜åŒ–

#### ğŸ“± **HTTPDNSè¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

**ä¼ ç»ŸDNSåœ¨ç§»åŠ¨ç½‘ç»œä¸­çš„é—®é¢˜**:
```
1. DNSåŠ«æŒä¸¥é‡
   - è¿è¥å•†æ’å…¥å¹¿å‘Š
   - è§£æç»“æœè¢«ç¯¡æ”¹

2. ç¼“å­˜ç­–ç•¥é—®é¢˜  
   - å¿½ç•¥TTLè®¾ç½®
   - ç¼“å­˜æ—¶é—´è¿‡é•¿

3. è°ƒåº¦ä¸å‡†ç¡®
   - NATå¯¼è‡´ä½ç½®è¯¯åˆ¤
   - è·¨è¿è¥å•†è®¿é—®

4. è§£æå»¶è¿Ÿé«˜
   - é€’å½’æŸ¥è¯¢è€—æ—¶
   - ç½‘ç»œç¯å¢ƒå¤æ‚
```

##### **HTTPDNSè§£å†³æ–¹æ¡ˆ**

```python
import requests
import json
import time

class HTTPDNSClient:
    def __init__(self):
        # æ¨¡æ‹ŸHTTPDNSæœåŠ¡ç«¯ç‚¹
        self.httpdns_servers = [
            'http://119.29.29.98/d',  # è…¾è®¯HTTPDNS
            'http://203.107.1.1/161874/d',  # é˜¿é‡ŒHTTPDNS (éœ€è¦account_id)
        ]
        self.cache = {}
        self.cache_ttl = {}
    
    def resolve_domain(self, domain, server_index=0):
        """HTTPDNSåŸŸåè§£æ"""
        # æ£€æŸ¥æœ¬åœ°ç¼“å­˜
        if self.is_cached(domain):
            print(f"ç¼“å­˜å‘½ä¸­: {domain} â†’ {self.cache[domain]}")
            return self.cache[domain]
        
        # HTTPDNSæŸ¥è¯¢
        try:
            url = f"{self.httpdns_servers[server_index]}"
            params = {'dn': domain}
            
            start_time = time.time()
            response = requests.get(url, params=params, timeout=3)
            query_time = (time.time() - start_time) * 1000
            
            if response.status_code == 200):
                try:
                    data = response.json()
                    if 'dns' in data and data['dns']:
                        dns_record = data['dns'][0]
                        ips = dns_record.get('ips', [])
                        ttl = dns_record.get('ttl', 300)
                        
                        if ips:
                            # ç¼“å­˜ç»“æœ
                            self.cache[domain] = ips[0]
                            self.cache_ttl[domain] = time.time() + ttl
                            
                            print(f"HTTPDNSè§£æ: {domain} â†’ {ips[0]} "
                                  f"(è€—æ—¶: {query_time:.1f}ms, TTL: {ttl}s)")
                            return ips[0]
                except json.JSONDecodeError:
                    # ç®€å•æ–‡æœ¬å“åº”
                    ip = response.text.strip()
                    if self.is_valid_ip(ip):
                        self.cache[domain] = ip
                        self.cache_ttl[domain] = time.time() + 300  # é»˜è®¤5åˆ†é’Ÿ
                        
                        print(f"HTTPDNSè§£æ: {domain} â†’ {ip} "
                              f"(è€—æ—¶: {query_time:.1f}ms)")
                        return ip
            
            print(f"HTTPDNSè§£æå¤±è´¥: {domain}")
            return None
            
        except Exception as e:
            print(f"HTTPDNSè¯·æ±‚é”™è¯¯: {e}")
            return None
    
    def is_cached(self, domain):
        """æ£€æŸ¥åŸŸåæ˜¯å¦åœ¨ç¼“å­˜ä¸­ä¸”æœªè¿‡æœŸ"""
        if domain not in self.cache:
            return False
        
        if domain in self.cache_ttl:
            return time.time() < self.cache_ttl[domain]
        
        return False
    
    def is_valid_ip(self, ip_str):
        """éªŒè¯IPåœ°å€æ ¼å¼"""
        import socket
        try:
            socket.inet_aton(ip_str)
            return True
        except:
            return False
    
    def intelligent_scheduling(self, domain, user_info):
        """æ™ºèƒ½è°ƒåº¦ç¤ºä¾‹"""
        print(f"\n=== æ™ºèƒ½è°ƒåº¦: {domain} ===")
        print(f"ç”¨æˆ·ä¿¡æ¯: {user_info}")
        
        # æ¨¡æ‹Ÿæ ¹æ®ç”¨æˆ·ä¿¡æ¯é€‰æ‹©æœ€ä¼˜IP
        scheduling_result = {
            'beijing': '1.1.1.1',    # åŒ—äº¬èŠ‚ç‚¹
            'shanghai': '2.2.2.2',   # ä¸Šæµ·èŠ‚ç‚¹
            'guangzhou': '3.3.3.3',  # å¹¿å·èŠ‚ç‚¹
        }
        
        user_city = user_info.get('city', 'beijing').lower()
        optimal_ip = scheduling_result.get(user_city, '1.1.1.1')
        
        print(f"é€‰æ‹©èŠ‚ç‚¹: {user_city} â†’ {optimal_ip}")
        return optimal_ip
    
    def compare_with_traditional_dns(self, domain):
        """ä¸ä¼ ç»ŸDNSå¯¹æ¯”"""
        print(f"\n=== DNSè§£æå¯¹æ¯”: {domain} ===")
        
        # ä¼ ç»ŸDNS
        import socket
        start_time = time.time()
        try:
            traditional_ip = socket.gethostbyname(domain)
            traditional_time = (time.time() - start_time) * 1000
            print(f"ä¼ ç»ŸDNS: {traditional_ip} (è€—æ—¶: {traditional_time:.1f}ms)")
        except:
            traditional_ip = "è§£æå¤±è´¥"
            traditional_time = -1
            print(f"ä¼ ç»ŸDNS: è§£æå¤±è´¥")
        
        # HTTPDNS
        httpdns_ip = self.resolve_domain(domain)
        
        # å¯¹æ¯”ç»“æœ
        if httpdns_ip and traditional_ip != "è§£æå¤±è´¥":
            if httpdns_ip == traditional_ip:
                print("âœ… è§£æç»“æœä¸€è‡´")
            else:
                print("âš ï¸ è§£æç»“æœä¸åŒ - å¯èƒ½ä½¿ç”¨äº†æ™ºèƒ½è°ƒåº¦")

# HTTPDNSæ¼”ç¤º
httpdns_client = HTTPDNSClient()

# åŸºæœ¬è§£æ
print("=== HTTPDNSåŸºæœ¬è§£æ ===")
httpdns_client.resolve_domain('www.qq.com')

# æ™ºèƒ½è°ƒåº¦
print("\n=== æ™ºèƒ½è°ƒåº¦æ¼”ç¤º ===")
user_info = {'city': 'Shanghai', 'isp': 'China Mobile'}
httpdns_client.intelligent_scheduling('api.example.com', user_info)

# ä¸ä¼ ç»ŸDNSå¯¹æ¯”
httpdns_client.compare_with_traditional_dns('www.baidu.com')

# ç¼“å­˜æœºåˆ¶æ¼”ç¤º
print("\n=== ç¼“å­˜æœºåˆ¶æ¼”ç¤º ===")
httpdns_client.resolve_domain('www.qq.com')  # ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œåº”è¯¥å‘½ä¸­ç¼“å­˜
```

---

### 8. DNSå®é™…åº”ç”¨æ¡ˆä¾‹åˆ†æ

#### ğŸŒ **å¤§å‹ç½‘ç«™çš„DNSæ¶æ„**

##### **å…¨çƒåŒ–ç½‘ç«™DNSè®¾è®¡**

```python
class GlobalDNSArchitecture:
    def __init__(self):
        self.regions = {
            'asia': {
                'dns_servers': ['ns1.asia.example.com', 'ns2.asia.example.com'],
                'ip_pools': ['1.1.1.1', '1.1.1.2', '1.1.1.3'],
                'cdn_nodes': ['beijing', 'tokyo', 'singapore']
            },
            'europe': {
                'dns_servers': ['ns1.eu.example.com', 'ns2.eu.example.com'],
                'ip_pools': ['2.2.2.1', '2.2.2.2', '2.2.2.3'],
                'cdn_nodes': ['london', 'frankfurt', 'amsterdam']
            },
            'americas': {
                'dns_servers': ['ns1.us.example.com', 'ns2.us.example.com'],
                'ip_pools': ['3.3.3.1', '3.3.3.2', '3.3.3.3'],
                'cdn_nodes': ['new_york', 'los_angeles', 'toronto']
            }
        }
    
    def geolocation_routing(self, user_location, domain):
        """åœ°ç†ä½ç½®è·¯ç”±"""
        print(f"\n=== åœ°ç†ä½ç½®è·¯ç”±: {domain} ===")
        print(f"ç”¨æˆ·ä½ç½®: {user_location}")
        
        # ç®€åŒ–çš„åœ°ç†ä½ç½®æ˜ å°„
        location_mapping = {
            'china': 'asia',
            'japan': 'asia',
            'singapore': 'asia',
            'uk': 'europe',
            'germany': 'europe',
            'france': 'europe',
            'usa': 'americas',
            'canada': 'americas',
            'brazil': 'americas'
        }
        
        region = location_mapping.get(user_location.lower(), 'americas')
        region_config = self.regions[region]
        
        # é€‰æ‹©æœ€è¿‘çš„IP
        selected_ip = region_config['ip_pools'][0]  # ç®€åŒ–é€‰æ‹©é€»è¾‘
        
        print(f"è·¯ç”±åˆ°åŒºåŸŸ: {region}")
        print(f"è¿”å›IP: {selected_ip}")
        print(f"CDNèŠ‚ç‚¹: {', '.join(region_config['cdn_nodes'])}")
        
        return {
            'region': region,
            'ip': selected_ip,
            'cdn_nodes': region_config['cdn_nodes']
        }
    
    def failover_mechanism(self, primary_region, domain):
        """æ•…éšœè½¬ç§»æœºåˆ¶"""
        print(f"\n=== æ•…éšœè½¬ç§»æœºåˆ¶: {domain} ===")
        print(f"ä¸»è¦åŒºåŸŸ: {primary_region}")
        
        # æ¨¡æ‹ŸåŒºåŸŸå¥åº·æ£€æŸ¥
        health_status = {
            'asia': True,
            'europe': False,  # æ¨¡æ‹Ÿæ¬§æ´²åŒºåŸŸæ•…éšœ
            'americas': True
        }
        
        if health_status[primary_region]:
            print(f"âœ… {primary_region} åŒºåŸŸæ­£å¸¸")
            return self.regions[primary_region]['ip_pools'][0]
        else:
            print(f"âŒ {primary_region} åŒºåŸŸæ•…éšœ")
            
            # å¯»æ‰¾å¤‡ç”¨åŒºåŸŸ
            for region, status in health_status.items():
                if status and region != primary_region:
                    print(f"ğŸ”„ æ•…éšœè½¬ç§»åˆ° {region} åŒºåŸŸ")
                    return self.regions[region]['ip_pools'][0]
            
            print("ğŸš¨ æ‰€æœ‰åŒºåŸŸéƒ½ä¸å¯ç”¨")
            return None
    
    def cdn_optimization(self, content_type, user_location):
        """CDNä¼˜åŒ–ç­–ç•¥"""
        print(f"\n=== CDNä¼˜åŒ–ç­–ç•¥ ===")
        print(f"å†…å®¹ç±»å‹: {content_type}")
        print(f"ç”¨æˆ·ä½ç½®: {user_location}")
        
        # ä¸åŒå†…å®¹ç±»å‹çš„ä¼˜åŒ–ç­–ç•¥
        optimization_strategies = {
            'static': {
                'description': 'é™æ€èµ„æº (CSS, JS, å›¾ç‰‡)',
                'strategy': 'edge_cache',
                'ttl': 86400,  # 24å°æ—¶
                'compression': True
            },
            'dynamic': {
                'description': 'åŠ¨æ€å†…å®¹ (APIå“åº”)',
                'strategy': 'origin_shield',
                'ttl': 300,   # 5åˆ†é’Ÿ
                'compression': False
            },
            'video': {
                'description': 'è§†é¢‘å†…å®¹',
                'strategy': 'bandwidth_optimization',
                'ttl': 3600,  # 1å°æ—¶
                'compression': True
            }
        }
        
        strategy = optimization_strategies.get(content_type, 
                                             optimization_strategies['static'])
        
        print(f"å†…å®¹æè¿°: {strategy['description']}")
        print(f"ä¼˜åŒ–ç­–ç•¥: {strategy['strategy']}")
        print(f"ç¼“å­˜TTL: {strategy['ttl']}ç§’")
        print(f"å¯ç”¨å‹ç¼©: {'æ˜¯' if strategy['compression'] else 'å¦'}")
        
        return strategy

# å…¨çƒDNSæ¶æ„æ¼”ç¤º
global_dns = GlobalDNSArchitecture()

# åœ°ç†ä½ç½®è·¯ç”±
locations = ['china', 'uk', 'usa']
for location in locations:
    global_dns.geolocation_routing(location, 'www.example.com')

# æ•…éšœè½¬ç§»
global_dns.failover_mechanism('europe', 'api.example.com')

# CDNä¼˜åŒ–
content_types = ['static', 'dynamic', 'video']
for content_type in content_types:
    global_dns.cdn_optimization(content_type, 'china')
```

#### ğŸ”§ **DNSæ•…éšœæ’æŸ¥å·¥å…·**

```python
import subprocess
import time
import socket

class DNSTroubleshooter:
    def __init__(self):
        self.diagnostic_tools = ['nslookup', 'dig', 'ping']
    
    def comprehensive_check(self, domain):
        """ç»¼åˆDNSæ£€æŸ¥"""
        print(f"=== DNSç»¼åˆè¯Šæ–­: {domain} ===\n")
        
        # 1. åŸºæœ¬è¿é€šæ€§æ£€æŸ¥
        self.connectivity_check(domain)
        
        # 2. DNSè§£ææ£€æŸ¥
        self.resolution_check(domain)
        
        # 3. æƒå¨DNSæ£€æŸ¥
        self.authoritative_check(domain)
        
        # 4. é€’å½’è·¯å¾„æ£€æŸ¥
        self.recursive_path_check(domain)
        
        # 5. æ€§èƒ½æ£€æŸ¥
        self.performance_check(domain)
    
    def connectivity_check(self, domain):
        """è¿é€šæ€§æ£€æŸ¥"""
        print("1. è¿é€šæ€§æ£€æŸ¥")
        print("-" * 30)
        
        try:
            # Pingæ£€æŸ¥
            result = subprocess.run(['ping', '-c', '3', domain], 
                                  capture_output=True, text=True, timeout=10)
            
            if result.returncode == 0:
                lines = result.stdout.split('\n')
                for line in lines:
                    if 'time=' in line:
                        print(f"âœ… PingæˆåŠŸ: {line.strip()}")
                        break
            else:
                print(f"âŒ Pingå¤±è´¥: {domain}")
                
        except Exception as e:
            print(f"âŒ Pingæ£€æŸ¥é”™è¯¯: {e}")
        
        print()
    
    def resolution_check(self, domain):
        """DNSè§£ææ£€æŸ¥"""
        print("2. DNSè§£ææ£€æŸ¥")
        print("-" * 30)
        
        # æ£€æŸ¥ä¸åŒè®°å½•ç±»å‹
        record_types = ['A', 'AAAA', 'CNAME', 'MX', 'NS']
        
        for record_type in record_types:
            try:
                result = subprocess.run(['nslookup', '-type=' + record_type, domain], 
                                      capture_output=True, text=True, timeout=5)
                
                if result.returncode == 0 and 'NXDOMAIN' not in result.stdout:
                    lines = result.stdout.split('\n')
                    for line in lines:
                        if domain in line and ('address' in line.lower() or 
                                             'mail exchanger' in line.lower()):
                            print(f"âœ… {record_type}è®°å½•: {line.strip()}")
                            break
                else:
                    print(f"âŒ {record_type}è®°å½•: æœªæ‰¾åˆ°")
                    
            except Exception as e:
                print(f"âŒ {record_type}è®°å½•æ£€æŸ¥é”™è¯¯: {e}")
        
        print()
    
    def authoritative_check(self, domain):
        """æƒå¨DNSæ£€æŸ¥"""
        print("3. æƒå¨DNSæ£€æŸ¥")
        print("-" * 30)
        
        try:
            # æŸ¥æ‰¾æƒå¨DNSæœåŠ¡å™¨
            result = subprocess.run(['nslookup', '-type=NS', domain], 
                                  capture_output=True, text=True, timeout=5)
            
            if result.returncode == 0:
                ns_servers = []
                lines = result.stdout.split('\n')
                
                for line in lines:
                    if 'nameserver' in line:
                        ns = line.split('=')[-1].strip()
                        ns_servers.append(ns)
                        print(f"ğŸ“ æƒå¨DNS: {ns}")
                
                # æ£€æŸ¥æƒå¨DNSçš„å“åº”
                if ns_servers:
                    for ns in ns_servers[:2]:  # æ£€æŸ¥å‰ä¸¤ä¸ª
                        self.check_ns_response(domain, ns)
                        
        except Exception as e:
            print(f"âŒ æƒå¨DNSæ£€æŸ¥é”™è¯¯: {e}")
        
        print()
    
    def check_ns_response(self, domain, ns_server):
        """æ£€æŸ¥ç‰¹å®šDNSæœåŠ¡å™¨çš„å“åº”"""
        try:
            result = subprocess.run(['nslookup', domain, ns_server], 
                                  capture_output=True, text=True, timeout=5)
            
            if result.returncode == 0 and 'NXDOMAIN' not in result.stdout:
                print(f"  âœ… {ns_server} å“åº”æ­£å¸¸")
            else:
                print(f"  âŒ {ns_server} å“åº”å¼‚å¸¸")
                
        except Exception as e:
            print(f"  âŒ {ns_server} æ£€æŸ¥é”™è¯¯: {e}")
    
    def recursive_path_check(self, domain):
        """é€’å½’è·¯å¾„æ£€æŸ¥"""
        print("4. é€’å½’è§£æè·¯å¾„æ£€æŸ¥")
        print("-" * 30)
        
        try:
            # ä½¿ç”¨digè¿½è¸ªé€’å½’è·¯å¾„
            result = subprocess.run(['dig', '+trace', domain], 
                                  capture_output=True, text=True, timeout=10)
            
            if result.returncode == 0:
                lines = result.stdout.split('\n')
                step = 1
                
                for line in lines:
                    if '.' in line and ('NS' in line or 'A' in line):
                        print(f"  æ­¥éª¤{step}: {line.strip()}")
                        step += 1
                        if step > 5:  # é™åˆ¶æ˜¾ç¤ºæ­¥éª¤æ•°
                            break
            else:
                print("âŒ é€’å½’è·¯å¾„è¿½è¸ªå¤±è´¥")
                
        except Exception as e:
            print(f"âŒ é€’å½’è·¯å¾„æ£€æŸ¥é”™è¯¯: {e}")
        
        print()
    
    def performance_check(self, domain):
        """æ€§èƒ½æ£€æŸ¥"""
        print("5. DNSæ€§èƒ½æ£€æŸ¥")
        print("-" * 30)
        
        # å¤šæ¬¡æŸ¥è¯¢æµ‹è¯•æ€§èƒ½
        times = []
        for i in range(5):
            start_time = time.time()
            try:
                socket.gethostbyname(domain)
                query_time = (time.time() - start_time) * 1000
                times.append(query_time)
                print(f"  æŸ¥è¯¢{i+1}: {query_time:.1f}ms")
            except Exception as e:
                print(f"  æŸ¥è¯¢{i+1}: å¤±è´¥ - {e}")
        
        if times:
            avg_time = sum(times) / len(times)
            min_time = min(times)
            max_time = max(times)
            
            print(f"\næ€§èƒ½ç»Ÿè®¡:")
            print(f"  å¹³å‡å»¶è¿Ÿ: {avg_time:.1f}ms")
            print(f"  æœ€å°å»¶è¿Ÿ: {min_time:.1f}ms")
            print(f"  æœ€å¤§å»¶è¿Ÿ: {max_time:.1f}ms")
            
            # æ€§èƒ½è¯„ä¼°
            if avg_time < 50:
                print("  ğŸ“ˆ æ€§èƒ½è¯„çº§: ä¼˜ç§€")
            elif avg_time < 100:
                print("  ğŸ“Š æ€§èƒ½è¯„çº§: è‰¯å¥½")
            elif avg_time < 200:
                print("  ğŸ“‰ æ€§èƒ½è¯„çº§: ä¸€èˆ¬")
            else:
                print("  ğŸ“› æ€§èƒ½è¯„çº§: éœ€è¦ä¼˜åŒ–")

# DNSæ•…éšœæ’æŸ¥æ¼”ç¤º
troubleshooter = DNSTroubleshooter()

# å¯¹å¸¸ç”¨ç½‘ç«™è¿›è¡Œç»¼åˆæ£€æŸ¥
domains = ['google.com', 'github.com']
for domain in domains:
    troubleshooter.comprehensive_check(domain)
    print("=" * 60)
```

---

### ğŸ“š å­¦ä¹ æ€»ç»“

#### âœ… **æ ¸å¿ƒè¦ç‚¹å›é¡¾**

1. **é—®é¢˜å¯¼å‘ç†è§£**: DNSè§£å†³IPåœ°å€éš¾è®°å¿†ã€éš¾ç®¡ç†çš„é—®é¢˜
2. **åˆ†å±‚æ¶æ„**: æ ¹â†’é¡¶çº§åŸŸâ†’æƒå¨DNSçš„æ ‘çŠ¶ç»“æ„
3. **è§£ææµç¨‹**: é€’å½’æŸ¥è¯¢çš„å®Œæ•´è¿‡ç¨‹å’Œç¼“å­˜æœºåˆ¶
4. **è´Ÿè½½å‡è¡¡**: DNSåœ¨æµé‡åˆ†å‘å’ŒæœåŠ¡å‘ç°ä¸­çš„åº”ç”¨
5. **å®‰å…¨ä¼˜åŒ–**: ç°ä»£DNSå®‰å…¨æŠ€æœ¯å’Œæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

#### ğŸ¯ **å®è·µå»ºè®®**

1. **åŠ¨æ‰‹å®éªŒ**:
   - ä½¿ç”¨nslookupã€digç­‰å·¥å…·æŸ¥è¯¢DNSè®°å½•
   - é…ç½®æœ¬åœ°DNSæœåŠ¡å™¨ (å¦‚BIND)
   - å®ç°ç®€å•çš„DNSè´Ÿè½½å‡è¡¡

2. **å·¥å…·æŒæ¡**:
   - å‘½ä»¤è¡Œå·¥å…·: nslookup, dig, host
   - ç½‘ç»œç›‘æ§: Wiresharkåˆ†æDNSæµé‡
   - åœ¨çº¿å·¥å…·: DNSæŸ¥è¯¢ç½‘ç«™ã€DNSä¼ æ’­æ£€æŸ¥

3. **é¡¹ç›®å®è·µ**:
   - ä¸ºé¡¹ç›®é…ç½®DNSè®°å½•
   - å®ç°DNSå¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»
   - ä¼˜åŒ–DNSè§£ææ€§èƒ½

**ğŸ’¡ å­¦ä¹ æç¤º**: DNSæ˜¯äº’è”ç½‘åŸºç¡€è®¾æ–½çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç†è§£å…¶å·¥ä½œåŸç†å¯¹äºç½‘ç»œç®¡ç†ã€ç³»ç»Ÿè¿ç»´å’ŒWebå¼€å‘éƒ½éå¸¸é‡è¦ã€‚å»ºè®®é€šè¿‡å®é™…é…ç½®å’Œæ•…éšœæ’æŸ¥æ¥åŠ æ·±ç†è§£ï¼Œç‰¹åˆ«å…³æ³¨DNSåœ¨ç°ä»£äº‘è®¡ç®—å’Œå¾®æœåŠ¡æ¶æ„ä¸­çš„åº”ç”¨ã€‚è®°ä½ï¼ŒDNSä¸ä»…ä»…æ˜¯åŸŸåè§£æï¼Œæ›´æ˜¯ç°ä»£ç½‘ç»œæ¶æ„ä¸­è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°å’Œæ•…éšœè½¬ç§»çš„é‡è¦å·¥å…·ã€‚

